<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Discovery Session</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="container">
        <header>
            <img class="logo" src="images/logo.png" alt="Company Logo">
            <h1 id="typewriter" data-text="Client Discovery Questions"></h1>
            <p class="fade-in">Powered by NextGen AI - Efficient, Accurate, Reliable.</p>
        </header>

        <form id="discovery-form">
            <div class="category fade-in">
                <h2>Business Overview</h2>
                <div class="contact-grid">
                    <div class="question-item">
                        <label for="business_name">Business Name *</label>
                        <input type="text" id="business_name" name="business_name" required placeholder="Your business name">
                    </div>
                    <div class="question-item">
                        <label for="years_in_operation">Years in Operation *</label>
                        <input type="text" id="years_in_operation" name="years_in_operation" required placeholder="e.g., 5">
                    </div>
                    <div class="question-item">
                        <label for="employee_count">Number of Employees *</label>
                        <input type="number" id="employee_count" name="employee_count" required min="0" placeholder="e.g., 12">
                    </div>
                    <div class="question-item">
                        <label for="annual_revenue">Annual Revenue</label>
                        <select id="annual_revenue" name="annual_revenue">
                            <option value="">Select a range</option>
                            <option value="<$100K"><$100K</option>
                            <option value="$100K–$250K">$100K–$250K</option>
                            <option value="$250K–$500K">$250K–$500K</option>
                            <option value="$500K–$1M">$500K–$1M</option>
                            <option value="$1M–$3M">$1M–$3M</option>
                            <option value="$3M–$5M">$3M–$5M</option>
                            <option value="$5M–$10M">$5M–$10M</option>
                            <option value="$10M+">$10M+</option>
                        </select>
                        <div class="help-text">Select a range or enter an estimated exact figure below.</div>
                        <input type="number" id="annual_revenue_exact" name="annual_revenue_exact" min="0" step="1000" placeholder="Estimated annual revenue (e.g., 750000)">
                    </div>
                    <div class="question-item">
                        <label for="service_coverage">Service Coverage *</label>
                        <select id="service_coverage" name="service_coverage" required>
                            <option value="">Select coverage</option>
                            <option value="Single City">Single City</option>
                            <option value="Multiple Cities">Multiple Cities</option>
                            <option value="Statewide">Statewide</option>
                            <option value="Nationwide">Nationwide</option>
                        </select>
                    </div>
                    <div class="question-item">
                        <label for="seasonality">Seasonality</label>
                        <textarea id="seasonality" name="seasonality" rows="3" placeholder="Describe any seasonal patterns"></textarea>
                    </div>
                </div>
            </div>

            <div class="category fade-in">
                <h2>Marketing & Strategy</h2>
                <div class="question-item">
                    <label for="decision_maker">Main Marketing Decision-Maker *</label>
                    <input type="text" id="decision_maker" name="decision_maker" required placeholder="Name / Role">
                </div>
                <div class="question-item">
                    <label for="capacity_for_more_leads">Lead Handling Capacity *</label>
                    <div class="help-text">Can your team handle additional leads right now? Choose "Depends on Season" if capacity varies during busy/slow seasons.</div>
                    <select id="capacity_for_more_leads" name="capacity_for_more_leads" required>
                        <option value="">Select an option</option>
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                        <option value="Depends on Season">Depends on Season</option>
                    </select>
                    <input type="number" id="additional_leads_capacity" name="additional_leads_capacity" min="0" step="1" placeholder="Approx. additional leads you can handle per month (optional)">
                </div>
                <div class="question-item">
                    <label for="ideal_customer">Ideal Customer Profile *</label>
                    <textarea id="ideal_customer" name="ideal_customer" rows="3" required placeholder="Who do you most want to reach?"></textarea>
                </div>
                <div class="question-item">
                    <label for="competitors">Top Competitors *</label>
                    <textarea id="competitors" name="competitors" rows="3" required placeholder="List main competitors"></textarea>
                </div>
                <div class="question-item">
                    <label for="unique_offers">Unique Advantages/Offers *</label>
                    <textarea id="unique_offers" name="unique_offers" rows="3" required placeholder="What sets you apart?"></textarea>
                </div>
                <div class="question-item">
                    <label>Current Marketing Channels</label>
                    <div>
                        <label><input type="checkbox" name="current_marketing_channels" value="Google Ads"> Google Ads</label>
                    </div>
                    <div>
                        <label><input type="checkbox" name="current_marketing_channels" value="Facebook/Instagram"> Facebook/Instagram</label>
                    </div>
                    <div>
                        <label><input type="checkbox" name="current_marketing_channels" value="TikTok"> TikTok</label>
                    </div>
                    <div>
                        <label><input type="checkbox" name="current_marketing_channels" value="Email Marketing"> Email Marketing</label>
                    </div>
                    <div>
                        <label><input type="checkbox" name="current_marketing_channels" value="SEO"> SEO</label>
                    </div>
                    <div>
                        <label><input type="checkbox" name="current_marketing_channels" value="Referrals"> Referrals</label>
                    </div>
                    <div>
                        <label><input type="checkbox" name="current_marketing_channels" value="Other"> Other</label>
                    </div>
                </div>
                <div class="question-item">
                    <label for="past_marketing_results">Past Marketing Results *</label>
                    <textarea id="past_marketing_results" name="past_marketing_results" rows="3" required placeholder="What has/hasn't worked?"></textarea>
                </div>
                <div class="question-item">
                    <label>Main Business Goals</label>
                    <div>
                        <label><input type="checkbox" name="business_goals" value="More Leads"> More Leads</label>
                    </div>
                    <div>
                        <label><input type="checkbox" name="business_goals" value="Brand Awareness"> Brand Awareness</label>
                    </div>
                    <div>
                        <label><input type="checkbox" name="business_goals" value="Repeat Customers"> Repeat Customers</label>
                    </div>
                    <div>
                        <label><input type="checkbox" name="business_goals" value="Increase Revenue"> Increase Revenue</label>
                    </div>
                    <div>
                        <label><input type="checkbox" name="business_goals" value="Other"> Other</label>
                    </div>
                </div>
            </div>

            <div class="category fade-in">
                <h2>Operations & Access</h2>
                <div class="question-item">
                    <label for="access_to_accounts">Website/Social Media Access *</label>
                    <select id="access_to_accounts" name="access_to_accounts" required>
                        <option value="">Select an option</option>
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                        <option value="Partially">Partially</option>
                    </select>
                </div>
                <div class="question-item">
                    <label for="growth_challenge">Biggest Growth Challenge *</label>
                    <textarea id="growth_challenge" name="growth_challenge" rows="3" required placeholder="What's the biggest challenge?"></textarea>
                </div>
                <div class="question-item">
                    <label for="vision_12_months">12-Month Vision *</label>
                    <textarea id="vision_12_months" name="vision_12_months" rows="3" required placeholder="Where do you want to be in 12 months?"></textarea>
                </div>
                <div class="question-item">
                    <label><input type="checkbox" id="consent" name="consent" required> I agree to share my information for the purpose of preparing a marketing strategy</label>
                </div>
            </div>

            <div class="submit-container fade-in">
                <button type="submit" id="submit-btn">Send My Details</button>
            </div>
        </form>
    </div>

    <script src="config.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('discovery-form');
            const webhookUrl = (typeof window !== 'undefined' && window.CONFIG && window.CONFIG.webhookUrl)
                ? window.CONFIG.webhookUrl
                : (typeof CONFIG !== 'undefined' && CONFIG.webhookUrl ? CONFIG.webhookUrl : null);

            form.addEventListener('submit', async (event) => {
                event.preventDefault();

                const submitBtn = document.getElementById('submit-btn');
                submitBtn.textContent = 'Submitting...';
                submitBtn.disabled = true;

                const formData = new FormData(form);
                const data = {
                    business_name: (formData.get('business_name') || '').trim(),
                    years_in_operation: (formData.get('years_in_operation') || '').trim(),
                    employee_count: formData.get('employee_count') !== null && formData.get('employee_count') !== '' ? Number(formData.get('employee_count')) : null,
                    annual_revenue: formData.get('annual_revenue') || '',
                    annual_revenue_exact: formData.get('annual_revenue_exact') !== null && formData.get('annual_revenue_exact') !== '' ? Number(formData.get('annual_revenue_exact')) : null,
                    service_coverage: formData.get('service_coverage') || '',
                    seasonality: (formData.get('seasonality') || '').trim(),
                    decision_maker: (formData.get('decision_maker') || '').trim(),
                    capacity_for_more_leads: formData.get('capacity_for_more_leads') || '',
                    additional_leads_capacity: formData.get('additional_leads_capacity') !== null && formData.get('additional_leads_capacity') !== '' ? Number(formData.get('additional_leads_capacity')) : null,
                    ideal_customer: (formData.get('ideal_customer') || '').trim(),
                    competitors: (formData.get('competitors') || '').trim(),
                    unique_offers: (formData.get('unique_offers') || '').trim(),
                    current_marketing_channels: Array.from(document.querySelectorAll('input[name="current_marketing_channels"]:checked')).map(el => el.value),
                    past_marketing_results: (formData.get('past_marketing_results') || '').trim(),
                    access_to_accounts: formData.get('access_to_accounts') || '',
                    business_goals: Array.from(document.querySelectorAll('input[name="business_goals"]:checked')).map(el => el.value),
                    growth_challenge: (formData.get('growth_challenge') || '').trim(),
                    vision_12_months: (formData.get('vision_12_months') || '').trim(),
                    consent: formData.get('consent') === 'on'
                };

                try {
                    if (!webhookUrl) {
                        throw new Error('Webhook URL is not configured.');
                    }

                    const response = await fetch(webhookUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            ...data,
                            _meta: {
                                submission_origin: window.location.origin,
                                submission_path: window.location.pathname,
                                submitted_at: new Date().toISOString(),
                                content_type: 'application/json'
                            }
                        }),
                        mode: 'cors',
                        credentials: 'omit'
                    });

                    if (!response.ok) {
                        const text = await response.text().catch(() => '');
                        throw new Error(`Server responded with status: ${response.status} ${text}`);
                    }

                    window.location.href = 'thank-you.html';
                } catch (error) {
                    console.error('Primary JSON submission failed, attempting fallback...', error);
                    try {
                        // Fallback: simple form-encoded POST with no-cors
                        const params = new URLSearchParams();
                        Object.entries(data).forEach(([key, value]) => {
                            if (Array.isArray(value)) {
                                value.forEach(v => params.append(key, String(v)));
                            } else if (value !== null && value !== undefined) {
                                params.append(key, String(value));
                            }
                        });
                        params.append('_meta_submission_origin', window.location.origin);
                        params.append('_meta_submission_path', window.location.pathname);
                        params.append('_meta_submitted_at', new Date().toISOString());
                        params.append('_meta_content_type', 'application/x-www-form-urlencoded');

                        await fetch(webhookUrl, {
                            method: 'POST',
                            mode: 'no-cors',
                            body: params
                        });

                        // We cannot read the response in no-cors mode; optimistically redirect.
                        window.location.href = 'thank-you.html';
                    } catch (fallbackError) {
                        submitBtn.textContent = 'Submission Failed';
                        submitBtn.style.backgroundColor = '#e74c3c';
                        console.error('Fallback submission also failed:', fallbackError);
                        setTimeout(() => {
                            submitBtn.textContent = 'Send My Details';
                            submitBtn.disabled = false;
                            submitBtn.style.backgroundColor = '';
                        }, 3000);
                    }
                }
            });
        });
    </script>
    <script src="background.js"></script>
    <script src="fancy-animations.js"></script>

</body>
</html> 